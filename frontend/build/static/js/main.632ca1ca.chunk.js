(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{137:function(e,t,a){e.exports=a(284)},142:function(e,t,a){},143:function(e,t,a){},284:function(e,t,a){"use strict";a.r(t);var n,r,l,c=a(0),s=a.n(c),i=a(50),o=a.n(i),u=(a(142),a(27)),m=(a(143),a(12)),d=a(4),p=Object(d.b)("dataStore")(Object(d.c)(function(e){var t=e.dataStore,a=Object(u.g)();return s.a.createElement("nav",null,s.a.createElement("div",{className:"nav-wrapper blue-grey"},s.a.createElement("div",{className:"container"},s.a.createElement(m.b,{to:"/",className:"brand-logo"},"e-com"),s.a.createElement("ul",{className:"right"},s.a.createElement("li",null," ",t.isAuthenticated?s.a.createElement("span",null,"Hi there ",t.currentUser.firstName," "):null," "),s.a.createElement("li",null," ",t.isAuthenticated?s.a.createElement("span",{onClick:function(){t.handleLogoutState(),a.push("/")}},"logout"):s.a.createElement(m.b,{to:"/login"},"login")," "),s.a.createElement("li",null,s.a.createElement(m.b,{to:"/basket"},s.a.createElement("i",{className:"material-icons"},"shopping_cart")))))))})),b=a(42),h=(new b.a,Object(d.b)("dataStore")(Object(d.c)(function(e){var t=e.dataStore;Object(c.useEffect)(function(){t.getBasket()},[]);var a=t.basketContent.map(function(e){return s.a.createElement("div",{className:"card red",key:e.product.id},s.a.createElement("div",{className:""},s.a.createElement("div",{className:"card-image"},s.a.createElement("img",{src:e.product.pictureUrl,alt:e.product.name}),s.a.createElement("span",{className:"card-title"},e.product.name)),s.a.createElement("div",{className:"card-content row white"},s.a.createElement("div",{className:"col s6"},s.a.createElement("b",null,"Price: \xa3",e.product.price)),s.a.createElement("div",{className:"col s6"},s.a.createElement("b",null,"Quantity: ",e.quantity)))))});return s.a.createElement("div",null,s.a.createElement("div",{className:"container grey"},s.a.createElement("div",null,a),s.a.createElement("div",{className:""},"Subtotal: \xa3",t.basket.basketPrice)))}))),E=Object(d.b)("dataStore")(Object(d.c)(function(e){var t=e.dataStore;return Object(c.useEffect)(function(){t.getCurrentUser()},[]),s.a.createElement("div",{className:"container"},s.a.createElement("h3",null,t.isAuthenticated?s.a.createElement("div",null,s.a.createElement("p",null,t.currentUser.firstName)):s.a.createElement("p",null,"Not Signed In")))})),f=Object(d.b)("dataStore")(Object(d.c)(function(e){var t=e.dataStore;Object(c.useEffect)(function(){t.getProducts()},[]);var a=t.products.map(function(e){return s.a.createElement("div",{className:"card red",key:e.id},s.a.createElement("div",{className:"col s12 m4 l4"},s.a.createElement(m.b,{to:"/products/".concat(e.id)},s.a.createElement("div",{className:"card-image"},s.a.createElement("img",{src:e.pictureUrl,alt:e.name}),s.a.createElement("span",{className:"card-title"},e.name)),s.a.createElement("div",{className:"card-content white"},s.a.createElement("p",null,s.a.createElement("b",null,"Price: ",e.price,"$"))))))});return s.a.createElement("div",{className:"container white"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:""},a)))})),g=function(){return s.a.createElement(f,null)},v=Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_API_BASE_URL||"http://localhost",N=Object({NODE_ENV:"production",PUBLIC_URL:""}).REACT_APP_API_PORT||"8080",O=a(23),w=a(9),j=a(294),k=w.object().shape({firstName:w.string().min(2,"Too Short!").max(50,"Too Long!").required("Required"),lastName:w.string().min(2,"Too Short!").max(50,"Too Long!").required("Required")}),y=function(){return s.a.createElement(O.b,{initialValues:{firstName:"",lastName:"",address1:"",city:"",postcode:""},validationSchema:k,onSubmit:function(e){console.log(e),alert("This is a mock order! click ok to redirect to homepage"),window.location.href="/"}},function(e){var t=e.errors,a=e.touched,n=e.values,r=e.handleChange,l=e.handleBlur;return s.a.createElement(O.a,null,s.a.createElement(j.a,{name:"firstName",type:"text",placeholder:"First Name",value:n.firstName,onChange:r,onBlur:l,disableUnderline:!0,className:t.firstName&&a.firstName&&"error"}),t.firstName&&a.firstName?s.a.createElement("div",null,t.firstName):null,s.a.createElement("br",null),s.a.createElement(j.a,{name:"lastName",type:"text",placeholder:"Last Name",value:n.lastName,onChange:r,onBlur:l,disableUnderline:!0,className:t.lastName&&a.lastName&&"error"}),t.lastName&&a.lastName?s.a.createElement("div",null,t.lastName):null,s.a.createElement("br",null),s.a.createElement(j.a,{name:"address1",type:"text",placeholder:"Address",value:n.address1,onChange:r,onBlur:l,disableUnderline:!0,className:t.address1&&a.address1&&"error"}),t.address1&&a.address1?s.a.createElement("div",null,t.address1):null,s.a.createElement("br",null),s.a.createElement(j.a,{name:"city",type:"text",placeholder:"City",value:n.city,onChange:r,onBlur:l,disableUnderline:!0,className:t.city&&a.city&&"error"}),t.city&&a.city?s.a.createElement("div",null,t.city):null,s.a.createElement("br",null),s.a.createElement(j.a,{name:"postcode",type:"text",placeholder:"Postcode",value:n.city,onChange:r,onBlur:l,disableUnderline:!0,className:t.postcode&&a.postcode&&"error"}),t.postcode&&a.postcode?s.a.createElement("div",null,t.postcode):null,s.a.createElement("br",null),s.a.createElement("button",{type:"submit"},"Pay Now"))})},S=Object(d.b)("dataStore")(Object(d.c)(function(e){var t=e.dataStore;return Object(c.useEffect)(function(){t.getBasket()},[]),s.a.createElement("h1",null,t.basket.basketPrice)})),C=function(){var e=localStorage.getItem("accessToken");return console.log("logged: "+e),e?s.a.createElement("div",null,s.a.createElement("h1",null,"Checkout"),s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col s3 "},s.a.createElement(S,null)),s.a.createElement("div",{className:"col s9 "},s.a.createElement(y,null)))):s.a.createElement(u.a,{to:"/basket"})},P=a(26),U=a(20),B=a(43),x=a(41),q=a(44),T=Object(d.b)("dataStore")(n=Object(d.c)(n=function(e){function t(){var e,a;Object(P.a)(this,t);for(var n=arguments.length,r=new Array(n),l=0;l<n;l++)r[l]=arguments[l];return(a=Object(B.a)(this,(e=Object(x.a)(t)).call.apply(e,[this].concat(r)))).handleClick=function(){var e=a.props.match.params.id;fetch(v+":"+N+"/basket/add/".concat(e),{method:"POST"}).then(function(e){console.log("data in basket: "+e.json()),a.props.dataStore.basket=e}).catch(function(){return console.log("Add to basket api call failed")}),a.props.history.push("/basket")},a}return Object(q.a)(t,e),Object(U.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.match.params.id;this.props.dataStore.getProductDetail(e)}},{key:"render",value:function(){return s.a.createElement("div",{className:"container"},s.a.createElement("div",{className:""},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col s4"},s.a.createElement("img",{src:this.props.dataStore.productDetail.pictureUrl,alt:this.props.dataStore.productDetail.name})),s.a.createElement("div",{className:"col s8"},s.a.createElement("div",{className:"row"},s.a.createElement("div",{className:"col s12"},this.props.dataStore.productDetail.name),this.props.dataStore.productDetail.price,s.a.createElement("div",{className:"col s12"})))),s.a.createElement("button",{className:"btn waves-effect waves-teal",onClick:this.handleClick},"Add To Basket")))}}]),t}(c.Component))||n)||n,A=w.object().shape({usernameOrEmail:w.string().required("Required"),password:w.string().required("No password provided.")}),z=Object(d.b)("dataStore")(r=Object(d.c)(r=function(e){function t(e){var a;return Object(P.a)(this,t),(a=Object(B.a)(this,Object(x.a)(t).call(this,e))).state={badCredentials:!1},a}return Object(q.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(O.b,{initialValues:{usernameOrEmail:"",password:""},onSubmit:function(t){var a=JSON.stringify(t);e.props.dataStore.login(a).then(function(t){localStorage.setItem("accessToken",t.accessToken),e.props.dataStore.handleLogin(),e.props.history.push("/")}).catch(function(t){console.log(t),401===t.status&&e.setState({badCredentials:!0})})},validationSchema:A},function(t){var a=t.errors,n=t.touched,r=t.values,l=t.handleChange,c=t.handleBlur;return s.a.createElement(O.a,null,s.a.createElement("p",null,"Please login or ",s.a.createElement(m.b,{to:"/signup"},"signup")," "),s.a.createElement(j.a,{name:"usernameOrEmail",type:"text",placeholder:"Username or Email",value:r.usernameOrEmail,onChange:l,onBlur:c,disableUnderline:!0,className:a.usernameOrEmail&&n.usernameOrEmail&&"error"}),a.usernameOrEmail&&n.usernameOrEmail&&s.a.createElement("div",{className:"input-feedback"},a.usernameOrEmail),s.a.createElement("br",null),s.a.createElement(j.a,{name:"password",type:"password",placeholder:"Password",value:r.password,onChange:l,onBlur:c,disableUnderline:!0,className:a.password&&n.password&&"error"}),a.password&&n.password&&s.a.createElement("div",{className:"input-feedback"},a.password),s.a.createElement("br",null),e.state.badCredentials?s.a.createElement("div",{className:"input-feedback"},"Incorrect username or password"):null,s.a.createElement("br",null),s.a.createElement("button",{className:"btn waves-effect waves-light",type:"submit"},"Login"))})}}]),t}(c.Component))||r)||r,L=w.object().shape({name:w.string().required("Required"),username:w.string().required("Required"),email:w.string().email().required("Required"),password:w.string().required("No password provided.").min(8,"Password is too short - should be 8 chars minimum."),passwordConfirm:w.string().oneOf([w.ref("password"),null],"Passwords must match").required("Password confirm is required")}),D=Object(d.b)("dataStore")(l=Object(d.c)(l=function(e){function t(e){var a;return Object(P.a)(this,t),(a=Object(B.a)(this,Object(x.a)(t).call(this,e))).handleErrors=function(e){"Username is already taken!"===e.message&&a.setState({usernameExists:!0}),"Email is already taken!"===e.message&&a.setState({emailExists:!0})},a.state={userNameExists:!1,emailExists:!1},a}return Object(q.a)(t,e),Object(U.a)(t,[{key:"render",value:function(){var e=this;return s.a.createElement(O.b,{initialValues:{name:"",username:"",email:"",password:"",passwordConfirm:""},onSubmit:function(t){var a=JSON.stringify(t);e.setState({usernameExists:!1,emailExists:!1}),e.props.dataStore.signup(a).then(function(t){e.props.history.push("/login")}).catch(function(t){console.log("caught"),e.handleErrors(t)})},validationSchema:L},function(t){var a=t.values,n=t.errors,r=t.touched,l=t.handleChange,c=t.handleBlur;return s.a.createElement(O.a,null,s.a.createElement(j.a,{name:"name",type:"text",placeholder:"Name",value:a.name,onChange:l,onBlur:c,disableUnderline:!0,className:n.name&&r.name&&"error"}),n.name&&r.name&&s.a.createElement("div",{className:"input-feedback"},n.name),s.a.createElement("br",null),s.a.createElement(j.a,{name:"username",type:"text",placeholder:"Username",value:a.username,onChange:l,onBlur:c,disableUnderline:!0,className:n.username&&r.username&&"error"}),n.username&&r.username&&s.a.createElement("div",{className:"input-feedback"},n.username),!0===e.state.usernameExists&&s.a.createElement("div",{className:"input-feedback"},"Username already exsists"),s.a.createElement("br",null),s.a.createElement(j.a,{name:"email",type:"text",placeholder:"Email",value:a.email,onChange:l,onBlur:c,disableUnderline:!0,className:n.email&&r.email&&"error"}),n.email&&r.email&&s.a.createElement("div",{className:"input-feedback"},n.email),s.a.createElement("br",null),s.a.createElement(j.a,{name:"password",type:"password",placeholder:"Password",value:a.password,onChange:l,onBlur:c,disableUnderline:!0,className:n.password&&r.password&&"error"}),n.password&&r.password&&s.a.createElement("div",{className:"input-feedback"},n.password),!0===e.state.emailExists&&s.a.createElement("div",{className:"input-feedback"},"Email already exsists"),s.a.createElement("br",null),s.a.createElement(j.a,{name:"passwordConfirm",type:"password",placeholder:"Confirm Password",value:a.passwordConfirm,onChange:l,onBlur:c,disableUnderline:!0,className:n.passwordConfirm&&r.passwordConfirm&&"error"}),n.passwordConfirm&&r.passwordConfirm&&s.a.createElement("div",{className:"input-feedback"},n.passwordConfirm),s.a.createElement("br",null),s.a.createElement("br",null),s.a.createElement("button",{className:"btn waves-effect waves-light",type:"submit"},"Register"))})}}]),t}(c.Component))||l)||l;(new b.a).set("cookieID","1",{path:"/"});var I=Object(d.b)("dataStore")(Object(d.c)(function(e){var t=e.dataStore;return Object(c.useEffect)(function(){t.handleLogin()},[]),s.a.createElement("div",{className:"App"},s.a.createElement(p,null),s.a.createElement(u.d,null,s.a.createElement(u.b,{exact:!0,path:"/",component:g}),s.a.createElement(u.b,{path:"/basket",component:h}),s.a.createElement(u.b,{path:"/products/:id",component:T}),s.a.createElement(u.b,{path:"/checkout",component:C}),s.a.createElement(u.b,{path:"/login",component:z}),s.a.createElement(u.b,{path:"/signup",component:D}),s.a.createElement(u.b,{path:"/user",component:E})))})),R=Object(u.h)(I);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var _,V,J,H,W,$,F,G,M,Q,K,X,Y,Z,ee,te,ae=a(10),ne=a(11),re=(a(283),a(3)),le=new b.a,ce={dataStore:new(_=function e(){Object(P.a)(this,e),Object(ae.a)(this,"isAuthenticated",V,this),Object(ae.a)(this,"currentUser",J,this),Object(ae.a)(this,"basket",H,this),Object(ae.a)(this,"basketContent",W,this),Object(ae.a)(this,"products",$,this),Object(ae.a)(this,"productDetail",F,this),Object(ae.a)(this,"handleLogin",G,this),Object(ae.a)(this,"handleLogoutState",M,this),Object(ae.a)(this,"request",Q,this),Object(ae.a)(this,"getBasket",K,this),Object(ae.a)(this,"getProductDetail",X,this),Object(ae.a)(this,"getProducts",Y,this),Object(ae.a)(this,"getCurrentUser",Z,this),Object(ae.a)(this,"login",ee,this),Object(ae.a)(this,"signup",te,this)},V=Object(ne.a)(_.prototype,"isAuthenticated",[re.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),J=Object(ne.a)(_.prototype,"currentUser",[re.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),H=Object(ne.a)(_.prototype,"basket",[re.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),W=Object(ne.a)(_.prototype,"basketContent",[re.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$=Object(ne.a)(_.prototype,"products",[re.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),F=Object(ne.a)(_.prototype,"productDetail",[re.l],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),G=Object(ne.a)(_.prototype,"handleLogin",[re.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){e.getCurrentUser().then(function(t){e.currentUser=t,e.isAuthenticated=!0})}}}),M=Object(ne.a)(_.prototype,"handleLogoutState",[re.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){localStorage.removeItem("accessToken"),e.isAuthenticated=!1,e.currentUser={}}}}),Q=Object(ne.a)(_.prototype,"request",[re.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return function(e){var t=new Headers({"Content-Type":"application/json"});localStorage.getItem("accessToken")&&t.append("Authorization","Bearer "+localStorage.getItem("accessToken"));var a={headers:t};return e=Object.assign({},a,e),fetch(e.url,e).then(function(e){return e.json().then(function(t){return e.ok?t:Promise.reject(t)})})}}}),K=Object(ne.a)(_.prototype,"getBasket",[re.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){var t=le.get("cookieID");fetch(v+":"+N+"/basket/baskets/".concat(t)).then(function(e){return console.log(v),e.json()}).then(function(t){console.log(t),e.basket=t,console.log("this basket"+e.basket),e.basketContent=t.basketContent})}}}),X=Object(ne.a)(_.prototype,"getProductDetail",[re.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){fetch(v+":"+N+"/products/".concat(t)).then(function(e){return e.json()}).then(function(t){console.log("data: "+t),e.productDetail=t}).catch(function(){return console.log("Products api call failed")})}}}),Y=Object(ne.a)(_.prototype,"getProducts",[re.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){fetch(v+":"+N+"/products").then(function(e){return console.log(v),e.json()}).then(function(t){return e.products=t}).catch(function(){return console.log("Products api call failed")})}}}),Z=Object(ne.a)(_.prototype,"getCurrentUser",[re.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(){return localStorage.getItem("accessToken")?e.request({url:v+":"+N+"/user/me",method:"GET"}):Promise.reject("No access token set.")}}}),ee=Object(ne.a)(_.prototype,"login",[re.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){return e.request({url:v+":"+N+"/api/auth/signin",method:"POST",body:t})}}}),te=Object(ne.a)(_.prototype,"signup",[re.d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){var e=this;return function(t){return e.request({url:v+":"+N+"/api/auth/signup",method:"POST",body:t})}}}),_)};o.a.render(s.a.createElement(d.a,ce,s.a.createElement(m.a,null,s.a.createElement(R,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[137,1,2]]]);
//# sourceMappingURL=main.632ca1ca.chunk.js.map